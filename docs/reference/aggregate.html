<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Support for Item Hierarchies — hierarchy • arules</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/yeti/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>

<!-- mathjax -->
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">arules</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="https://cran.r-project.org/package=arules/vignettes/arules.pdf">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference Manual</a>
</li>
<li>
  <a href="../news/index.html">Change Log</a>
</li>
<li>
  <a href="https://github.com/mhahsler/arules/">Development Version</a>
</li>
<li>
  <a href="https://github.com/mhahsler/arules">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="http://michael.hahsler.net">Michael Hahsler (Maintainer)</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Support for Item Hierarchies</h1>
    </div>

    
    <p>Often an item hierarchy is available for datasets used for 
  association rule mining. For example in a supermarket dataset
  items like  &quot;bread&quot; and &quot;beagle&quot; might belong to the item
  group (category) &quot;baked goods.&quot;</p>

    <p>We provide support to use the item hierarchy to aggregate items 
  to different group levels, to
  produce multi-level transactions and to filter spurious    
  associations mined from multi-level transactions.</p>
    

    <pre><span class='co'># S4 method for itemMatrix</span>
<span class='fu'>aggregate</span>(<span class='no'>x</span>, <span class='no'>by</span>)
<span class='co'># S4 method for itemsets</span>
<span class='fu'>aggregate</span>(<span class='no'>x</span>, <span class='no'>by</span>)
<span class='co'># S4 method for rules</span>
<span class='fu'>aggregate</span>(<span class='no'>x</span>, <span class='no'>by</span>)
<span class='fu'>addAggregate</span>(<span class='no'>x</span>, <span class='no'>by</span>, <span class='kw'>postfix</span> <span class='kw'>=</span> <span class='st'>"*"</span>)
<span class='fu'>filterAggregate</span>(<span class='no'>x</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <dl class="dl-horizontal">
      <dt>x</dt>
      <dd>an transactions, itemsets or rules object.</dd>
      <dt>by</dt>
      <dd>name of a field (hierarchy level) available in 
    itemInfo or a vector of 
    character strings (factor) of the same length as items in <code>x</code>
    by which should be aggregated. Items receiving
    the same label in <code>by</code> will be aggregated into a single,
    higher-level item.</dd>
      <dt>postfix</dt>
      <dd>characters added to mark group-level items.</dd>
    </dl>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Transactions can store item hierarchies as additional columns in the 
  itemInfo data.frame (<code>&quot;labels&quot;</code> is reserved for the item labels).</p>
    <p><b>Aggregation:</b> To perform analysis at a group level of the item hierarchy,
  <code>agregate()</code> produces a new
  object with items aggregated to a given group level. A group-level item
  is present if one or more of the items in the group are present in 
  the original object.
  If rules are aggregated, and the 
  aggregation would lead to the same aggregated group item in the lhs and 
  in the rhs, then that group item is removed from the lhs. 
  Rules or itemsets, which are not     
  unique after the aggregation, are also removed. Note also that the 
  quality measures are not applicable to the new rules and thus are removed. 
  If these measures are required, then aggregate the transactions before 
  mining rules.</p>
    <p><b>Multi-level analysis:</b> To analyze relationships between 
  individual items 
  and item groups, <code>addAggregate()</code> creates a new transactions object
  which contains both, the original items and group-level items (marked with
  a given postfix). In association rule mining, all items are handled 
  the same, which means that we will produce a large number of rules
  of the type</p>
    <p>$$item A =&gt; group of item A$$</p>
    <p>with a confidence of 1. This happens also to itemsets 
  <code>filterAggregate()</code> can be used to
  filter these spurious rules or itemsets.</p>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>aggregate()</code> returns an object of the same class as <code>x</code> encoded
   with a number of items equal to the number of unique values in
   <code>by</code>. Note that for associations (itemsets and rules) 
   the number of associations in the 
   returned set will most likely be reduced since
   several associations might map to the same aggregated association and
   aggregate returns a unique set. If several associations map to
   a single aggregated association then the quality measures of one 
   of the original associations is randomly chosen.</p>
    <p><code>addAggregate()</code> returns a new transactions object with the
   original items and the group-items added. <code>filterAggregateRules()</code>
   returns a new rules object with the spurious rules remove.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'>data</span>(<span class='st'>"Groceries"</span>)
<span class='no'>Groceries</span></div><div class='output co'>#&gt; transactions in sparse format with
#&gt;  9835 transactions (rows) and
#&gt;  169 items (columns)</div><div class='input'>
<span class='co'>## Groceries contains a hierarchy stored in itemInfo</span>
<span class='fu'><a href='sort.html'>head</a></span>(<span class='fu'><a href='itemMatrix-class.html'>itemInfo</a></span>(<span class='no'>Groceries</span>))</div><div class='output co'>#&gt;              labels  level2           level1
#&gt; 1       frankfurter sausage meat and sausage
#&gt; 2           sausage sausage meat and sausage
#&gt; 3        liver loaf sausage meat and sausage
#&gt; 4               ham sausage meat and sausage
#&gt; 5              meat sausage meat and sausage
#&gt; 6 finished products sausage meat and sausage</div><div class='input'>
<span class='co'>## aggregate by level2</span>
<span class='no'>Groceries_level2</span> <span class='kw'>&lt;-</span> <span class='fu'>aggregate</span>(<span class='no'>Groceries</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='st'>"level2"</span>)
<span class='no'>Groceries_level2</span></div><div class='output co'>#&gt; transactions in sparse format with
#&gt;  9835 transactions (rows) and
#&gt;  55 items (columns)</div><div class='input'><span class='fu'><a href='sort.html'>head</a></span>(<span class='fu'><a href='itemMatrix-class.html'>itemInfo</a></span>(<span class='no'>Groceries_level2</span>)) <span class='co'>## labels are alphabetically sorted!</span></div><div class='output co'>#&gt;             labels           level2           level1
#&gt; 1        baby food        baby food      canned food
#&gt; 2             bags             bags         non-food
#&gt; 3  bakery improver  bakery improver   processed food
#&gt; 4 bathroom cleaner bathroom cleaner        detergent
#&gt; 5             beef             beef meat and sausage
#&gt; 6             beer             beer           drinks</div><div class='input'>
<span class='co'>## compare orginal and aggregated transactions</span>
<span class='fu'><a href='inspect.html'>inspect</a></span>(<span class='fu'><a href='sort.html'>head</a></span>(<span class='no'>Groceries</span>, <span class='fl'>2</span>))</div><div class='output co'>#&gt;     items                
#&gt; [1] {citrus fruit,       
#&gt;      semi-finished bread,
#&gt;      margarine,          
#&gt;      ready soups}        
#&gt; [2] {tropical fruit,     
#&gt;      yogurt,             
#&gt;      coffee}             </div><div class='input'><span class='fu'><a href='inspect.html'>inspect</a></span>(<span class='fu'><a href='sort.html'>head</a></span>(<span class='no'>Groceries_level2</span>, <span class='fl'>2</span>))</div><div class='output co'>#&gt;     items                   
#&gt; [1] {bread and backed goods,
#&gt;      fruit,                 
#&gt;      soups/sauces,          
#&gt;      vinegar/oils}          
#&gt; [2] {coffee,                
#&gt;      dairy produce,         
#&gt;      fruit}                 </div><div class='input'>
<span class='co'>## create lables manually (organize items by the first letter)</span>
<span class='no'>mylevels</span> <span class='kw'>&lt;-</span> <span class='fu'>toupper</span>(<span class='fu'>substr</span>(<span class='fu'><a href='itemMatrix-class.html'>itemLabels</a></span>(<span class='no'>Groceries</span>), <span class='fl'>1</span>, <span class='fl'>1</span>))
<span class='fu'><a href='sort.html'>head</a></span>(<span class='no'>mylevels</span>)</div><div class='output co'>#&gt; [1] &quot;F&quot; &quot;S&quot; &quot;L&quot; &quot;H&quot; &quot;M&quot; &quot;F&quot;</div><div class='input'>
<span class='no'>Groceries_alpha</span> <span class='kw'>&lt;-</span> <span class='fu'>aggregate</span>(<span class='no'>Groceries</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='no'>mylevels</span>)
<span class='no'>Groceries_alpha</span></div><div class='output co'>#&gt; transactions in sparse format with
#&gt;  9835 transactions (rows) and
#&gt;  23 items (columns)</div><div class='input'><span class='fu'><a href='inspect.html'>inspect</a></span>(<span class='fu'><a href='sort.html'>head</a></span>(<span class='no'>Groceries_alpha</span>, <span class='fl'>2</span>))</div><div class='output co'>#&gt;     items    
#&gt; [1] {C,M,R,S}
#&gt; [2] {C,T,Y}  </div><div class='input'>
<span class='co'>## aggregate rules </span>
<span class='co'>## Note: you could also directly mine rules from aggregated transactions to</span>
<span class='co'>## get support, lift and support</span>
<span class='no'>rules</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='apriori.html'>apriori</a></span>(<span class='no'>Groceries</span>, <span class='kw'>parameter</span><span class='kw'>=</span><span class='fu'>list</span>(<span class='kw'>supp</span><span class='kw'>=</span><span class='fl'>0.005</span>, <span class='kw'>conf</span><span class='kw'>=</span><span class='fl'>0.5</span>))</div><div class='output co'>#&gt; Apriori
#&gt; 
#&gt; Parameter specification:
#&gt;  confidence minval smax arem  aval originalSupport maxtime support minlen
#&gt;         0.5    0.1    1 none FALSE            TRUE       5   0.005      1
#&gt;  maxlen target   ext
#&gt;      10  rules FALSE
#&gt; 
#&gt; Algorithmic control:
#&gt;  filter tree heap memopt load sort verbose
#&gt;     0.1 TRUE TRUE  FALSE TRUE    2    TRUE
#&gt; 
#&gt; Absolute minimum support count: 49 
#&gt; 
#&gt; set item appearances ...[0 item(s)] done [0.00s].
#&gt; set transactions ...[169 item(s), 9835 transaction(s)] done [0.00s].
#&gt; sorting and recoding items ... [120 item(s)] done [0.00s].
#&gt; creating transaction tree ... done [0.00s].
#&gt; checking subsets of size 1 2 3 4 done [0.00s].
#&gt; writing ... [120 rule(s)] done [0.00s].
#&gt; creating S4 object  ... done [0.00s].</div><div class='input'><span class='no'>rules</span></div><div class='output co'>#&gt; set of 120 rules </div><div class='input'><span class='fu'><a href='inspect.html'>inspect</a></span>(<span class='no'>rules</span>[<span class='fl'>1</span>])</div><div class='output co'>#&gt;     lhs                rhs          support     confidence lift    
#&gt; [1] {baking powder} =&gt; {whole milk} 0.009252669 0.5229885  2.046793</div><div class='input'>
<span class='no'>rules_level2</span> <span class='kw'>&lt;-</span> <span class='fu'>aggregate</span>(<span class='no'>rules</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='st'>"level2"</span>)
<span class='fu'><a href='inspect.html'>inspect</a></span>(<span class='no'>rules_level2</span>[<span class='fl'>1</span>])</div><div class='output co'>#&gt;     lhs                  rhs            
#&gt; [1] {bakery improver} =&gt; {dairy produce}</div><div class='input'>
<span class='co'>## mine multi-level rules</span>
<span class='no'>Groceries_multilevel</span> <span class='kw'>&lt;-</span> <span class='fu'>addAggregate</span>(<span class='no'>Groceries</span>, <span class='st'>"level2"</span>)
<span class='fu'>summary</span>(<span class='no'>Groceries_multilevel</span>)</div><div class='output co'>#&gt; transactions as itemMatrix in sparse format with
#&gt;  9835 rows (elements/itemsets/transactions) and
#&gt;  224 columns (items) and a density of 0.03652589 
#&gt; 
#&gt; most frequent items:
#&gt;          dairy produce* bread and backed goods*        non-alc. drinks* 
#&gt;                    4357                    3398                    3127 
#&gt;             vegetables*              whole milk                 (Other) 
#&gt;                    2685                    2513                   64388 
#&gt; 
#&gt; element (itemset/transaction) length distribution:
#&gt; sizes
#&gt;    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16   17 
#&gt; 2159  151 1503  234 1094  297  736  320  594  301  376  272  330  218  212  173 
#&gt;   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32   33 
#&gt;  163  118  102   89   52   62   49   45   35   31   23   19    8   12   11    6 
#&gt;   34   35   36   37   38   39   40   41   42   47   48   49 
#&gt;    6    8    5    6    2    3    2    1    2    3    1    1 
#&gt; 
#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#&gt;   2.000   4.000   6.000   8.182  11.000  49.000 
#&gt; 
#&gt; includes extended item information - examples:
#&gt;        labels  level2           level1 aggregatedBy aggregateLevels aggregateID
#&gt; 1 frankfurter sausage meat and sausage         &lt;NA&gt;               1         213
#&gt; 2     sausage sausage meat and sausage         &lt;NA&gt;               1         213
#&gt; 3  liver loaf sausage meat and sausage         &lt;NA&gt;               1         213</div><div class='input'>
<span class='no'>rules</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='apriori.html'>apriori</a></span>(<span class='no'>Groceries_multilevel</span>,
  <span class='kw'>parameter</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>support</span> <span class='kw'>=</span> <span class='fl'>0.01</span>, <span class='kw'>conf</span> <span class='kw'>=</span><span class='fl'>.9</span>))</div><div class='output co'>#&gt; Apriori
#&gt; 
#&gt; Parameter specification:
#&gt;  confidence minval smax arem  aval originalSupport maxtime support minlen
#&gt;         0.9    0.1    1 none FALSE            TRUE       5    0.01      1
#&gt;  maxlen target   ext
#&gt;      10  rules FALSE
#&gt; 
#&gt; Algorithmic control:
#&gt;  filter tree heap memopt load sort verbose
#&gt;     0.1 TRUE TRUE  FALSE TRUE    2    TRUE
#&gt; 
#&gt; Absolute minimum support count: 98 
#&gt; 
#&gt; set item appearances ...[0 item(s)] done [0.00s].
#&gt; set transactions ...[224 item(s), 9835 transaction(s)] done [0.01s].
#&gt; sorting and recoding items ... [132 item(s)] done [0.00s].
#&gt; creating transaction tree ... done [0.00s].
#&gt; checking subsets of size 1 2 3 4 5 6 done [0.02s].
#&gt; writing ... [3649 rule(s)] done [0.00s].
#&gt; creating S4 object  ... done [0.00s].</div><div class='input'><span class='fu'><a href='inspect.html'>inspect</a></span>(<span class='fu'><a href='sort.html'>head</a></span>(<span class='no'>rules</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='st'>"lift"</span>))</div><div class='output co'>#&gt;     lhs                             rhs                             support confidence     lift
#&gt; [1] {packaged fruit/vegetables*} =&gt; {packaged fruit/vegetables}  0.01301474          1 76.83594
#&gt; [2] {packaged fruit/vegetables}  =&gt; {packaged fruit/vegetables*} 0.01301474          1 76.83594
#&gt; [3] {seasonal products}          =&gt; {seasonal products*}         0.01423488          1 70.25000
#&gt; [4] {seasonal products*}         =&gt; {seasonal products}          0.01423488          1 70.25000
#&gt; [5] {canned fish*}               =&gt; {canned fish}                0.01504830          1 66.45270
#&gt; [6] {canned fish}                =&gt; {canned fish*}               0.01504830          1 66.45270</div><div class='input'><span class='co'>## filter spurious rules </span>
<span class='no'>rules</span> <span class='kw'>&lt;-</span> <span class='fu'>filterAggregate</span>(<span class='no'>rules</span>)
<span class='fu'><a href='inspect.html'>inspect</a></span>(<span class='fu'><a href='sort.html'>head</a></span>(<span class='no'>rules</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='st'>"lift"</span>))</div><div class='output co'>#&gt;     lhs                          rhs                 support confidence     lift
#&gt; [1] {other vegetables,                                                          
#&gt;      bread and backed goods*,                                                   
#&gt;      cheese*,                                                                   
#&gt;      fruit*}                  =&gt; {dairy produce*} 0.01260803  0.9051095 2.043092</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#value">Value</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    Michael Hahsler
  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Michael Hahsler, Christian Buchta, Bettina Gruen, Kurt Hornik.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
